{# Limit 1000 can be removed to load all records #}
{% set gridData = gridBlock.getGridJsonDataWithLimit(1000) %}
{% set fields = gridBlock.getFields() %}
{% set fieldNames = gridBlock.getFieldsNames() %}
{% set initialPageSize = app.request.query.get('pageSize', 10)|default(10) %}
{% if initialPageSize not in [10, 25, 50, 100] %}{% set initialPageSize = 10 %}{% endif %}
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/ag-grid.min.css') }}">
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/ag-theme-alpine.min.css') }}">
<div class="container-fluid">
    <h1>Product Grid - HTML (AG Grid) - Client-side</h1>
    {% include '@GenakerDataGrid/_filters.html.twig' with {gridBlock: gridBlock} %}
    <div id="product-grid" class="ag-theme-alpine" style="height: 600px; width: 100%;"></div>
</div>
<script src="{{ asset('bundles/genakerdatagrid/js/ag-grid.min.js') }}"></script>
<script>
(function() {
    var rowData = {{ gridData.data|json_encode|raw }};
    var columnDefs = [{% for n in fieldNames %}
        {
            field: '{{ n|e('js') }}',
            headerName: '{{ (fields[n] ?? n)|e('js') }}',
            sortable: {{ n == 'image' ? 'false' : 'true' }},
            filter: {{ n == 'image' ? 'false' : 'true' }},
            {% if n == 'image' %}
            cellRenderer: (params) => { var img = document.createElement('img'); img.src = params.value || '{{ asset('bundles/genakerdatagrid/images/placeholder.svg')|e('js') }}'; img.style.maxWidth = '100px'; img.style.maxHeight = '80px'; img.alt = params.value ? 'Product' : 'No image'; return img; }
            {% endif %}
        }{% if not loop.last %}, {% endif %}
    {% endfor %}];
    agGrid.createGrid(document.getElementById('product-grid'), {
        theme: 'legacy',
        columnDefs: columnDefs,
        rowData: rowData,
        rowHeight: 90,
        pagination: true,
        paginationPageSize: {{ initialPageSize }},
        paginationPageSizeSelector: [10, 25, 50, 100],
        defaultColDef: { sortable: true, filter: true }
    });
})();
</script>
