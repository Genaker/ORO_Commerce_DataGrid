{# Limit 1000 can be removed to load all records #}
{% set gridData = gridBlock.getGridJsonDataWithLimit(1000) %}
{% set fields = gridBlock.getFields() %}
{% set fieldNames = gridBlock.getFieldsNames() %}
{% set initialPageSize = app.request.query.get('pageSize', 10)|default(10) %}
{% if initialPageSize not in [10, 25, 50, 100] %}{% set initialPageSize = 10 %}{% endif %}
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/tabulator.min.css') }}">
<div class="container-fluid">
    <h1>Product Grid - HTML (Tabulator) - Client-side</h1>
    {% include '@GenakerDataGrid/_filters.html.twig' with {gridBlock: gridBlock} %}
    <div id="product-grid"></div>
</div>
<script src="{{ asset('bundles/genakerdatagrid/js/tabulator.min.js') }}"></script>
<script>
(function() {
    var data = {{ gridData.data|json_encode|raw }};
    var columns = [{% for n in fieldNames %}
        {
            title: "{{ (fields[n] ?? n)|e('js') }}",
            field: "{{ n }}",
            {% if n == 'image' %}
            formatter: function(cell) { var url = cell.getValue(); return '<img src="' + (url || '{{ asset('bundles/genakerdatagrid/images/placeholder.svg')|e('js') }}') + '" style="max-width: 100px; max-height: 80px;" alt="' + (url ? 'Product' : 'No image') + '" />'; },
            headerSort: false
            {% else %}
            headerFilter: "input"
            {% endif %}
        }{% if not loop.last %},{% endif %}
    {% endfor %}];
    new Tabulator('#product-grid', {
        data: data,
        columns: columns,
        pagination: "local",
        paginationSize: {{ initialPageSize }},
        paginationSizeSelector: [10, 25, 50, 100],
        layout: "fitColumns",
        placeholder: "No Data Available"
    });
})();
</script>
