{% set dataUrl = gridBlock.getDataUrl() %}
{% set fields = gridBlock.getFields() %}
{% set fieldNames = gridBlock.getFieldsNames() %}
<div class="container-fluid">
    <h1>Product Grid - AJAX (DataTables)</h1>
    {% include '@GenakerDataGrid/GridJs/_filters.html.twig' with {gridBlock: gridBlock} %}
    <div id="product-grid-preloader" class="grid-preloader"><div class="grid-spinner"></div></div>
    <table id="product-grid" class="display" style="display: none;">
        <thead><tr>{% for n in fieldNames %}<th>{{ fields[n] ?? n }}</th>{% endfor %}</tr></thead>
        <tbody></tbody>
    </table>
</div>
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/datatables.min.css') }}">
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/preloader.css') }}">
<script src="{{ asset('bundles/genakerdatagrid/js/jquery.min.js') }}"></script>
<script src="{{ asset('bundles/genakerdatagrid/js/datatables.min.js') }}"></script>
<script>
$(function() {
    $.get('{{ dataUrl|e('js') }}', function(res) {
        var columns = [{% for n in fieldNames %}
            { 
                title: '{{ (fields[n] ?? n)|e('js') }}', 
                data: '{{ n|e('js') }}',
                {% if n == 'image' %}
                render: function(data) { return data ? `<img src="${data}" style="max-width: 100px; max-height: 80px;" />` : ''; }
                {% endif %}
            }{% if not loop.last %}, {% endif %}
        {% endfor %}];
        $('#product-grid').DataTable({ 
            data: res.data, 
            columns: columns, 
            pageLength: 20,
            initComplete: function() {
                $('#product-grid-preloader').hide();
                $('#product-grid').show();
            }
        });
    });
});
</script>
