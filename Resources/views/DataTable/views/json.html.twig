{% set gridData = gridBlock.getGridJsonData() %}
{% set fields = gridBlock.getFields() %}
{% set fieldNames = gridBlock.getFieldsNames() %}
<div class="container-fluid">
    <h1>Product Grid - Initial JSON (DataTables)</h1>
    {% include '@GenakerDataGrid/_filters.html.twig' with {gridBlock: gridBlock} %}
    <div id="product-grid-preloader" class="grid-preloader"><div class="grid-spinner"></div></div>
    <table id="product-grid" class="display" style="display: none;">
        <thead><tr>{% for n in fieldNames %}<th>{{ fields[n] ?? n }}</th>{% endfor %}</tr></thead>
        <tbody></tbody>
    </table>
</div>
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/datatables.min.css') }}">
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/preloader.css') }}">
<script src="{{ asset('bundles/genakerdatagrid/js/jquery.min.js') }}"></script>
<script src="{{ asset('bundles/genakerdatagrid/js/datatables.min.js') }}"></script>
<script>
$(function() {
    var data = {{ gridData.data|json_encode|raw }};
    var fieldIds = {{ fieldNames|json_encode|raw }};
    var columns = [{% for n in fieldNames %}
        { 
            title: '{{ (fields[n] ?? n)|e('js') }}', 
            data: '{{ n|e('js') }}',
            {% if n == 'image' %}
            render: function(data) { var src = data || '{{ asset('bundles/genakerdatagrid/images/placeholder.svg')|e('js') }}'; return `<img src="${src}" style="max-width: 100px; max-height: 80px;" alt="${data ? 'Product' : 'No image'}" />`; }
            {% endif %}
        }{% if not loop.last %}, {% endif %}
    {% endfor %}];
    $('#product-grid').DataTable({ 
        data: data, 
        columns: columns, 
        pageLength: 10,
        initComplete: function() {
            $('#product-grid-preloader').hide();
            $('#product-grid').show();
        }
    });
});
</script>
