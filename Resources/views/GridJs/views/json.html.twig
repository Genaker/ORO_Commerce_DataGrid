{% set gridData = gridBlock.getGridJsonData() %}
{% set fields = gridBlock.getFields() %}
{% set fieldNames = gridBlock.getFieldsNames() %}
<div class="container-fluid">
    <h1>Product Grid - Initial JSON (Grid.js)</h1>
    {% include '@GenakerDataGrid/GridJs/_filters.html.twig' with {gridBlock: gridBlock} %}
    <div id="product-grid-container"></div>
    <script type="application/json" id="grid-initial-data">{{ gridData|json_encode|raw }}</script>
</div>
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/gridjs-mermaid.min.css') }}">
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/preloader.css') }}">
<script src="{{ asset('bundles/genakerdatagrid/js/gridjs.min.js') }}"></script>
<script>
(function() {
    var container = document.getElementById('product-grid-container');
    container.innerHTML = '<div class="grid-preloader"><div class="grid-spinner"></div></div>';
    var cfg = JSON.parse(document.getElementById('grid-initial-data').textContent);
    var columns = [{% for n in fieldNames %}
        {
            name: '{{ (fields[n] ?? n)|e('js') }}',
            {% if n == 'image' %}
            formatter: (cell) => cell ? gridjs.html(`<img src="${cell}" style="max-width: 100px; max-height: 80px;" />`) : ''
            {% endif %}
        }{% if not loop.last %}, {% endif %}
    {% endfor %}];
    var data = cfg.data.map(function(row) {
        return [{% for n in fieldNames %}row['{{ n|e('js') }}'] != null ? row['{{ n|e('js') }}'] : ''{% if not loop.last %}, {% endif %}{% endfor %}];
    });
    var grid = new gridjs.Grid({ columns: columns, data: data, pagination: { limit: 20 } });
    container.innerHTML = '';
    grid.render(container);
})();
</script>
