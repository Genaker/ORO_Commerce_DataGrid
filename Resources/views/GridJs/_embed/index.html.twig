{% set gridData = gridBlock.getGridJsonData() %}
{% set dataUrl = gridBlock.getDataUrl() %}
{% set fields = gridBlock.getFields() %}
{% set fieldNames = gridBlock.getFieldsNames() %}
<div class="container-fluid">
    <h1>Product Grid (Grid.js)</h1>
    {% include '@GenakerDataGrid/GridJs/_filters.html.twig' with {gridBlock: gridBlock} %}
    <div id="product-grid-container"></div>
</div>
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/gridjs-mermaid.min.css') }}">
<link rel="stylesheet" href="{{ asset('bundles/genakerdatagrid/css/preloader.css') }}">
<script src="{{ asset('bundles/genakerdatagrid/js/gridjs.min.js') }}"></script>
<script>
(function() {
    var container = document.getElementById('product-grid-container');
    container.innerHTML = '<div class="grid-preloader"><div class="grid-spinner"></div></div>';
    var columns = [{% for n in fieldNames %}
        {
            name: '{{ (fields[n] ?? n)|e('js') }}',
            {% if n == 'image' %}
            formatter: (cell) => cell ? gridjs.html(`<img src="${cell}" style="max-width: 100px; max-height: 80px;" />`) : '',
            sort: false
            {% endif %}
        }{% if not loop.last %}, {% endif %}
    {% endfor %}];
    var rows = {{ gridData.data|json_encode|raw }};
    var fieldIds = {{ fieldNames|json_encode|raw }};
    var data = rows.map(function(row) {
        return fieldIds.map(function(id) { return row[id] != null ? row[id] : ''; });
    });
    var grid = new gridjs.Grid({
        columns: columns,
        data: data,
        sort: true,
        pagination: { limit: 20 }
    });
    container.innerHTML = '';
    grid.render(container);
})();
</script>
